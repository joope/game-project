<html>
  <head>
    <title>A Multiplayer Game</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
      body {
        margin: 0;
        padding: 0;
      }
      canvas {
        box-sizing: border-box;
        width: 100%;
        height: 100vh;
        border: 5px solid black;
      }
    </style>
    <script src="/socket.io/socket.io.js"></script>
  </head>
  <body>
    <canvas id="touchArea"></canvas>
  </body>
  <script>
    var socket = io();
    
    var touchArea = document.getElementById("touchArea");
    var ctx = touchArea.getContext("2d");

    var width = touchArea.offsetWidth;
    var height = touchArea.offsetHeight;

    var w_center = width / 2;
    var y_center = height / 2;

    var velocity = 0;
    var direction = 0;

    var controlInterval;

    console.log(width, height);

    function sendControl() {
      socket.emit('control', {v: velocity, d: direction});
    }

    function handlePosition(event) {
      event.preventDefault();
      direction = event.touches[0].pageX / w_center - 1;
      velocity = -1 * (event.touches[0].pageY / y_center - 1);
    }

    touchArea.addEventListener("touchstart", function(event){
      handlePosition(event);
    }, false);

    touchArea.addEventListener("touchmove", handlePosition, false);

    touchArea.addEventListener("touchend", function(){
      velocity = 0;
    }, false);

    document.addEventListener('keydown', function(event){
        switch (event.key)
        {
            case "ArrowUp":
		if (velocity > 1) velocity = 1;
		else if (velocity < -1)	velocity = -1;
                else if (velocity == 0) velocity = 0.1;
		else velocity = velocity + 0.1;
		break;
            case "ArrowDown":
		if (velocity > 1) velocity = 1;
		else if (velocity < -1)	velocity = -1;
                else if (velocity == 0) velocity = -0.1;
		else velocity = velocity - 0.1;
		break;
            case "ArrowLeft":
                direction = direction - 0.1;
		break;
            case "ArrowRight":
                direction = direction + 0.1;
		break;
        }
    });
	
    setInterval(sendControl, 10);

  </script>
</html>
